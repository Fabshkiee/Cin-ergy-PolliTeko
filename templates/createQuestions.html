<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Questions</title>
</head>
<body>
    <h1>CREATE NEW QUESTIONS</h1>
    <form id="createQuestionsForm" method="POST" action="/submit-issues">
        <div>
            <label for="chooseQuestion">CHOOSE QUESTION</label>
            <select id="chooseQuestion" name="chooseQuestion" required>
                <option value="" disabled selected>Select Question</option>
                <option value="question1">Multiple Choice Question</option>
                <option value="question2">Ranked Choice Question</option>
                <option value="question3">Issues and Controversies</option>
            </select>
        </div>

        <div id="dynamicFields"></div>
    </form>

    <script>
        const chooseQuestion = document.getElementById("chooseQuestion");

        chooseQuestion.addEventListener("change", function () {
            const selectedQuestion = this.value;

            const form = document.getElementById("createQuestionsForm");
            form.innerHTML = ""; // Clear existing fields

            if (selectedQuestion === "question3") {
                const head = document.createElement("h2");
                head.textContent = "ISSUES AND CONTROVERSIES";
                form.appendChild(head);

                const newInput = document.createElement("input");
                newInput.setAttribute("type", "text");
                newInput.setAttribute("id", "dynamicTextarea");
                newInput.setAttribute("placeholder", "List issues here...");
                form.append(newInput);

                const addButton = document.createElement("button");
                addButton.textContent = "Add Issue";
                addButton.type = "button";
                addButton.id = "buttonAdd";
                form.appendChild(addButton);

                const issueList = document.createElement("ol");
                issueList.setAttribute("id", "issueList");
                form.appendChild(issueList);

                const submitButton = document.createElement("button");
                submitButton.textContent = "Submit Issues";
                submitButton.type = "button";
                submitButton.id = "submitIssues";
                form.appendChild(submitButton);

                const issues = [];

                addButton.addEventListener("click", function () {
                    const issueValue = newInput.value.trim();
                    if (issueValue) {
                        issues.push(issueValue);
                        newInput.value = "";
                        issueList.innerHTML = "";

                        issues.forEach(issue => {
                            const li = document.createElement("li");
                            li.textContent = issue;

                            const del = document.createElement("button");
                            del.textContent = "Delete";
                            del.type = "button";

                            del.addEventListener("click", function () {
                                issues.splice(issues.indexOf(issue), 1);
                                issueList.removeChild(li);
                            });

                            li.appendChild(del);
                            issueList.appendChild(li);
                        });
                    }
                });

                submitButton.addEventListener("click", function () {
                    fetch("/submit-issues", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ issues }),
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert("Issues saved successfully!");
                            } else {
                                alert("Error saving issues: " + data.message);
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                            alert("Failed to save issues.");
                        });
                });
            }
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Questions</title>
</head>
<body>
    <h1>CREATE NEW QUESTIONS</h1>
    <form id="createQuestions" method="post" action="/save-question">
        <div>
            <label for="chooseQuestion">CHOOSE QUESTION</label>
            <select id="chooseQuestion" name="chooseQuestion" required>
                <option value="" disabled selected>Select Question</option>
                <option value="question1">Multiple Choice Question</option>
                <option value="question2">Ranked Choice Question</option>
                <option value="question3">Issues and Controversies</option>
            </select>
        </div>

        <div id="pillarsContainer" style="display: none;">
            <label for="pillarSelect">Select Pillar:</label>
            <select id="pillarSelect" name="pillar"></select>
        </div>

        <script>
            const chooseQuestion = document.getElementById("chooseQuestion");
            const pillarsContainer = document.getElementById("pillarsContainer");
            const pillarSelect = document.getElementById("pillarSelect");
            
            // Fetch pillars from Flask backend
            async function fetchPillars() {
                try {
                    const response = await fetch('/api/pillars');
                    if (!response.ok) throw new Error('Failed to fetch pillars');
                    const pillars = await response.json();
                    
                    // Clear existing options
                    pillarSelect.innerHTML = '';
                    
                    // Add new options
                    pillars.forEach(pillar => {
                        const option = document.createElement("option");
                        option.value = pillar;
                        option.textContent = pillar;
                        pillarSelect.appendChild(option);
                    });
                    
                    return true;
                } catch (error) {
                    console.error('Error fetching pillars:', error);
                    return false;
                }
            }
        
            chooseQuestion.addEventListener("change", async function () {
                const selectedQuestion = this.value;

                const existingTextarea = document.getElementById("dynamicTextarea");
                const existingSelect = document.getElementById("dynamicSelect");
                const existingHeading = document.querySelector("h2");
                const existingButton = document.getElementById("buttonAdd");
                const existingList = document.getElementById("issueList");
                const existingInput = document.querySelector("input[type='text']");
                const existingListItems = document.querySelectorAll("ol li");
                const existingSubmitButton = document.querySelector("button[type='submit']");

                if(existingTextarea) existingTextarea.remove();
                if(existingSelect) existingSelect.remove(); 
                if(existingButton) existingButton.remove();
                if(existingList) existingList.remove();
                if(existingHeading) existingHeading.remove();
                if(existingInput) existingInput.remove();
                if(existingSubmitButton) existingSubmitButton.remove();    
                
                // Show pillars dropdown
                const fetched = await fetchPillars();
                if (fetched) {
                    pillarsContainer.style.display = 'block';
                }

                const submit = document.createElement("button");
                submit.textContent = "Submit";
                submit.type = "submit";

                if (selectedQuestion === "question1" || selectedQuestion === "question2") {
                    const form = document.getElementById("createQuestions");
                    
                    const head = document.createElement("h2");
                    head.textContent = selectedQuestion === "question1" ? "MULTIPLE CHOICE QUESTION" : "RANKED CHOICE QUESTION";
                    form.appendChild(head);

                    const newInput = document.createElement("textarea");
                    newInput.setAttribute("id", "dynamicTextarea");
                    newInput.setAttribute("name", "questionText");
                    newInput.setAttribute("placeholder", "Enter your question here...");
                    newInput.setAttribute("rows", "4");
                    newInput.setAttribute("cols", "50");
                
                    const newInput2 = document.createElement("select");
                    newInput2.setAttribute("id", "dynamicSelect");
                    newInput2.setAttribute("name", "options");
                    newInput2.multiple = selectedQuestion === "question2";
                    
                    const options = [
                        {value: "option1", text: "Option 1"},
                        {value: "option2", text: "Option 2"},
                        {value: "option3", text: "Option 3"},
                    ];
                    
                    options.forEach(optionData => {
                        const option = document.createElement("option");
                        option.value = optionData.value;
                        option.textContent = optionData.text;
                        newInput2.appendChild(option);
                    });
                    
                    form.appendChild(newInput);
                    form.appendChild(newInput2);
                    form.appendChild(submit);
                
                } else if (selectedQuestion === "question3") {
                    const form = document.getElementById("createQuestions");

                    const head = document.createElement("h2");
                    head.textContent = "ISSUES AND CONTROVERSIES";
                    form.appendChild(head);

                    const newInput = document.createElement("input");
                    newInput.setAttribute("type", "text");
                    newInput.setAttribute("id", "dynamicTextarea");
                    newInput.setAttribute("placeholder", "List issues here...");
                    form.append(newInput);

                    const addButton = document.createElement("button");
                    addButton.textContent = "Add Issue";
                    addButton.type = "button"; 
                    addButton.id = "buttonAdd";
                    form.appendChild(addButton);
                        
                    const issueList = document.createElement("ol");
                    issueList.setAttribute("id", "issueList");
                    form.appendChild(issueList);

                    const issues = [];
                    
                    addButton.addEventListener("click", function () {
                        const issueValue = newInput.value.trim();
                        if (issueValue) {
                            issues.push(issueValue);
                            newInput.value = '';
                            issueList.innerHTML = ''; 
                            
                            issues.forEach(issue => {
                                const li = document.createElement("li");
                                li.textContent = issue;

                                const hiddenInput = document.createElement("input");
                                hiddenInput.type = "hidden";
                                hiddenInput.name = "issues[]";
                                hiddenInput.value = issue;
                                li.appendChild(hiddenInput);

                                const del = document.createElement("button");
                                del.textContent = "Delete";
                                del.type = "button";

                                del.addEventListener("click", function () {
                                    issues.splice(issues.indexOf(issue), 1);
                                    issueList.removeChild(li);
                                });

                                li.appendChild(del);
                                issueList.appendChild(li); 
                            });
                            form.appendChild(submit);
                        }
                    });
                }
            });
        </script>
    </form>
</body>
</html>